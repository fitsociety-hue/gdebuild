<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <?= metaTitle ? metaTitle : 'Mobile Content Builder' ?>
    </title>

    <!-- Open Graph for Social Sharing -->
    <meta property="og:title" content="<?= metaTitle ? metaTitle : 'Mobile Content Builder' ?>" />
    <meta property="og:description" content="<?= metaDescription ? metaDescription : '강동어울림복지관에서 안내합니다.' ?>" />
    <meta property="og:image"
        content="<?= metaImage ? metaImage : 'https://via.placeholder.com/1200x630?text=Mobile+Builder' ?>" />
    <meta property="og:type" content="website" />

    <!-- Absolute Path to CSS for Apps Script Compatibility (Cache Busting) -->
    <link rel="stylesheet" href="https://fitsociety-hue.github.io/gdebuild/style.css?v=1.1">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div id="app" class="builder-container">
        <!-- 1. Left Sidebar: Toolbox -->
        <aside class="toolbox">
            <div class="header">
                <div class="header-top">
                    <button id="btn-back-dashboard" class="icon-btn" title="대시보드로 이동"><i
                            class="fas fa-arrow-left"></i></button>
                    <h2>블록 도구</h2>
                </div>
            </div>
            <div class="tools-grid">
                <div class="tool-btn" draggable="true" data-type="header">
                    <i class="fas fa-heading"></i>
                    <span>헤드(제목)</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="text">
                    <i class="fas fa-font"></i>
                    <span>텍스트</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="image">
                    <i class="fas fa-image"></i>
                    <span>이미지</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="slide">
                    <i class="fas fa-images"></i>
                    <span>슬라이드</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="gallery">
                    <i class="fas fa-th-large"></i>
                    <span>갤러리</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="video">
                    <i class="fas fa-video"></i>
                    <span>영상</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="list">
                    <i class="fas fa-list-ul"></i>
                    <span>사업안내</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="schedule">
                    <i class="fas fa-calendar-alt"></i>
                    <span>일정</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="map">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>지도</span>
                </div>
                <div class="tool-btn" draggable="true" data-type="link">
                    <i class="fas fa-link"></i>
                    <span>링크 버튼</span>
                </div>
            </div>

            <div class="action-buttons">
                <button id="btn-save" class="primary-btn"><i class="fas fa-save"></i> 저장</button>
                <button id="btn-publish" class="success-btn"><i class="fas fa-share-square"></i> 게시</button>
            </div>
        </aside>

        <!-- 2. Center: Canvas / Preview -->
        <main class="canvas-area">
            <div class="canvas-header-controls">
                <span class="label">배경색:</span>
                <input type="color" id="global-bg-color" value="#ffffff" title="전체 배경 색상 변경">
                <h3 id="current-page-title" contenteditable="true">제목 없음</h3>
            </div>
            <div class="device-frame">
                <div class="device-screen">
                    <div id="canvas" class="canvas-content">
                        <!-- Blocks will be rendered here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 3. Right Sidebar: Properties -->
        <aside class="properties-panel">
            <div class="header">
                <h2>Properties</h2>
            </div>
            <div id="properties-content">
                <div class="empty-state">
                    <p>블록을 선택하여<br>속성을 편집하세요.</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Viewer Mode Container (Hidden by default in Editor) -->
    <div id="viewer-app" class="viewer-container hidden">
        <div id="viewer-content"></div>
        <div class="viewer-footer">
            <button class="make-page-btn" onclick="location.href='index.html'">
                <i class="fas fa-magic"></i> MY 페이지 무료로 만들기 >
            </button>
        </div>
    </div>

    <!-- Modal for Initial Template Selection -->
    <!-- Dynamic New Project Modal -->
    <div id="new-project-modal" class="modal hidden">
        <div class="modal-content md">
            <h2>새 프로젝트 만들기</h2>
            <div class="new-project-form">
                <div class="form-group">
                    <label>제목</label>
                    <input type="text" id="np-title" placeholder="예: 5월 가정의 달 행사 초대">
                </div>

                <div class="form-group">
                    <label>분류</label>
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-value="personal">개인</button>
                        <button class="toggle-btn" data-value="team">팀</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>유형 선택</label>
                    <div class="type-grid">
                        <button class="type-card selected" data-type="newsletter">뉴스레터</button>
                        <button class="type-card" data-type="promotion">홍보</button>
                        <button class="type-card" data-type="invitation">초대장</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>비밀번호 (4자리, 숫자/문자)</label>
                    <input type="text" id="np-password" maxlength="4" placeholder="0000">
                </div>

                <div class="form-group">
                    <label>작성자명 또는 팀명</label>
                    <input type="text" id="np-author" placeholder="예: 복지센터">
                </div>

                <div class="modal-actions">
                    <button class="secondary-btn" id="btn-close-new-project">취소</button>
                    <button class="primary-btn" id="btn-create-project">생성하기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Save/Password -->
    <div id="save-modal" class="modal hidden">
        <div class="modal-content sm">
            <h3 id="save-modal-title">저장 및 발행</h3>
            <div class="form-group">
                <label>페이지 비밀번호 (4자리)</label>
                <input type="text" id="save-password" maxlength="4" placeholder="1234">
            </div>
            <div class="modal-actions">
                <button id="confirm-save" class="primary-btn">확인</button>
                <button id="cancel-save" class="secondary-btn">취소</button>
            </div>
        </div>
    </div>

    <!-- Modal for Password Verification (Edit Access) -->
    <div id="verify-modal" class="modal hidden">
        <div class="modal-content sm">
            <h3>프로젝트 편집 접근</h3>
            <div class="form-group">
                <label>비밀번호 입력</label>
                <input type="text" id="verify-password" maxlength="4" placeholder="0000">
            </div>
            <div class="modal-actions">
                <button id="confirm-verify" class="primary-btn">확인</button>
                <button id="cancel-verify" class="secondary-btn">취소</button>
            </div>
        </div>
    </div>

    <!-- Modal for Publish Result (QR & URL) -->
    <div id="publish-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="publish-title">게시 완료</h3>
                <button class="close-modal-btn"
                    onclick="document.getElementById('publish-modal').classList.add('hidden')"><i
                        class="fas fa-times"></i></button>
            </div>

            <div class="publish-body">
                <div class="qr-section">
                    <p>QR 코드</p>
                    <div id="qr-code-img"></div>
                    <button class="secondary-btn btn-sm" onclick="downloadQR()">
                        <i class="fas fa-download"></i> QR 코드 다운로드
                    </button>
                </div>
                <div class="url-section">
                    <p>공유 URL</p>
                    <div class="url-copy-box">
                        <input type="text" id="share-url" readonly>
                        <button class="primary-btn" onclick="copyUrl()">
                            <i class="far fa-copy"></i> 복사
                        </button>
                    </div>
                    <p class="help-text">이 URL을 카카오톡이나 소셜 미디어에 공유하세요</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div id="dashboard-app" class="dashboard-container hidden">
        <header class="dashboard-header">
            <div class="brand">
                <h1>모바일 콘텐츠 통합 관리</h1>
                <p>만들어진 콘텐츠를 관리하고 새로운 프로젝트를 시작하세요.</p>
            </div>
            <div class="header-actions">
                <button id="btn-new-project" class="primary-btn scale-btn">
                    <i class="fas fa-plus"></i> 새 프로젝트 만들기
                </button>
            </div>
        </header>

        <section class="dashboard-content">
            <div class="tabs">
                <button class="tab-btn active">전체</button>
                <button class="tab-btn">개인</button>
                <button class="tab-btn">팀</button>
            </div>

            <div id="project-list" class="project-grid">
                <!-- Projects will be loaded here -->
                <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
            </div>
        </section>
    </div>

    <!-- Absolute Path to JS for Apps Script Compatibility (Cache Busting) -->
    <script src="https://fitsociety-hue.github.io/gdebuild/script.js?v=1.1"></script>
</body>

</html>